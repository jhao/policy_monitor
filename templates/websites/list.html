{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">关注网站列表</h2>
  <a href="{{ url_for('create_website') }}" class="btn btn-primary">新增网站</a>
</div>
<div class="table-responsive">
  <table class="table table-striped table-hover align-middle">
  <thead>
    <tr>
      <th>名称</th>
      <th>URL</th>
      <th>来源类型</th>
      <th>抓取子页面</th>
      <th>时间间隔(分钟)</th>
      <th>最后抓取时间</th>
      <th>内容区域定位</th>
      <th>标题定位</th>
      <th>正文定位</th>
      <th class="text-center">操作</th>
    </tr>
  </thead>
  <tbody>
    {% for website in websites %}
    <tr>
      <td>{{ website.name }}</td>
      <td>
        <a href="{{ website.url }}" target="_blank" rel="noopener noreferrer">访问网站</a>
      </td>
      <td>{{ 'JSON API' if website.is_json_api else '网页' }}</td>
      <td>{{ '是' if website.fetch_subpages else '否' }}</td>
      <td>{{ website.interval_minutes }}</td>
      <td>{{ website.last_fetched_at or '尚未抓取' }}</td>
      <td class="text-nowrap">
        {% if website.content_area_selector_config %}
        <span class="badge rounded-pill text-bg-success"
              data-bs-toggle="tooltip"
              data-bs-placement="top"
              data-bs-html="true"
              title="{{ website.content_area_selector_config | replace('\n', '<br>') | safe }}">
          已配置
        </span>
        {% else %}
        <span class="badge rounded-pill text-bg-secondary"
              data-bs-toggle="tooltip"
              data-bs-placement="top"
              title="尚未配置">
          未配置
        </span>
        {% endif %}
      </td>
      <td class="text-nowrap">
        {% if website.title_selector_config %}
        <span class="badge rounded-pill text-bg-success"
              data-bs-toggle="tooltip"
              data-bs-placement="top"
              data-bs-html="true"
              title="{{ website.title_selector_config | replace('\n', '<br>') | safe }}">
          已配置
        </span>
        {% else %}
        <span class="badge rounded-pill text-bg-secondary"
              data-bs-toggle="tooltip"
              data-bs-placement="top"
              title="尚未配置">
          未配置
        </span>
        {% endif %}
      </td>
      <td class="text-nowrap">
        {% if website.content_selector_config %}
        <span class="badge rounded-pill text-bg-success"
              data-bs-toggle="tooltip"
              data-bs-placement="top"
              data-bs-html="true"
              title="{{ website.content_selector_config | replace('\n', '<br>') | safe }}">
          已配置
        </span>
        {% else %}
        <span class="badge rounded-pill text-bg-secondary"
              data-bs-toggle="tooltip"
              data-bs-placement="top"
              title="尚未配置">
          未配置
        </span>
        {% endif %}
      </td>
      <td class="d-flex flex-wrap gap-2 justify-content-center">
        <a href="{{ url_for('edit_website', website_id=website.id) }}" class="btn btn-sm btn-secondary">编辑</a>
        {% if website.last_snapshot %}
        <a href="{{ url_for('view_website_snapshot', website_id=website.id) }}" class="btn btn-sm btn-outline-primary">查看快照</a>
        {% endif %}
        <form action="{{ url_for('delete_website', website_id=website.id) }}" method="post" class="d-inline" onsubmit="return confirm('确认删除该网站？');">
          <button class="btn btn-sm btn-danger">删除</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
</div>
{% endblock %}
